async function process() {
    const val = document.getElementById('inp').value.trim();
    const out = document.getElementById('res');
    if(!val) return alert("Kuch likhen...");

    out.style.display = 'block';
    out.innerText = "Processing... Please wait.";

    try {
        if(activeTool === 'thumb') {
            // Updated Regex: Jo har tarah ke YT links ko handle karega
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
            const match = val.match(regex);
            const id = match ? match[1] : null;

            if(id) {
                out.innerHTML = `
                    <div style="text-align:center;">
                        <img src="https://img.youtube.com/vi/${id}/maxresdefault.jpg" width="100%" style="border-radius:8px; border:1px solid #ddd;">
                        <p style="margin-top:10px; font-weight:bold; color:#555;">HD Quality</p>
                        <a href="https://img.youtube.com/vi/${id}/maxresdefault.jpg" target="_blank" download="thumbnail.jpg" 
                           style="display:inline-block; background:red; color:white; padding:10px 20px; text-decoration:none; border-radius:5px; font-weight:bold;">
                           Download HD Thumbnail
                        </a>
                    </div>`;
            } else { 
                out.innerText = "Error: Invalid YouTube Link. Please copy the link correctly."; 
            }
        } 
        // ... (Baki tools ka code waisa hi rahega)
        else if(activeTool === 'keywords') {
            const proxy = "https://api.allorigins.win/get?url=";
            const target = `https://suggestqueries.google.com/complete/search?client=firefox&ds=yt&q=${encodeURIComponent(val)}`;
            const response = await fetch(proxy + encodeURIComponent(target));
            const data = await response.json();
            const suggestions = JSON.parse(data.contents)[1];
            out.innerText = suggestions.length > 0 ? "Trending Keywords:\n\n" + suggestions.join("\n") : "No keywords found.";
        } 
        else if(activeTool === 'tags' || activeTool === 'script') {
            let prompt = activeTool === 'tags' ? `Generate 20 SEO tags for: ${val}` : `Write a script for: ${val}`;
            const r = await puter.ai.chat(prompt);
            out.innerText = r.toString();
        }
    } catch(e) {
        out.innerText = "Error: System slow hai ya link galat hai.";
    }
}
